#=======================================
# Environment Variables
#=======================================
export DEV="/Volumes/Projects/Dev"

#=======================================
# Shell Configuration Aliases
#=======================================
# Scripts directory
alias mm="$DEV/.claude/config/cache_cleanup.sh"

#=======================================
# General Aliases
#=======================================

alias c='clear'
alias co='code'
alias un='unalias'
alias claude='claude --dangerously-skip-permissions'

#=======================================
# Development Aliases
#=======================================
alias deck='cd $DEV/Repos/DeckFoundry && source .venv/bin/activate && ./deck'

#=======================================
# Package Manager Aliases
#=======================================
alias p='pnpm'
alias n='npm'

#=======================================
# Infrastructure Aliases
#=======================================
alias t='terraform'
alias tfg='terraform graph > graph.dot'

#=======================================
# Git Aliases
#=======================================

# Basic git operations
alias g='git'
alias ga='git add'
alias gall='git add . && git status'
alias gb='git branch'
alias gbd='git branch -D'
alias gbc='git checkout -b'
alias gce='git checkout'
alias gc='git commit -m'
alias gca='git commit -am'

# Git information
alias gs='git status'
alias gl='git log'
alias gd='git diff'
alias gdc='git diff --cached'

# Git remote operations
alias gp='git push'
alias gf='git fetch --prune'
alias gbr='git branch -r'
alias gcl='git clone'
alias grd='git push origin --delete'

# Git advanced operations
alias gr='git reset'
alias gst='git stash'
alias gra='git rebase --abort'
alias gsqm='git merge --squash --no-commit'
alias gurl='echo "$(git config --get remote.origin.url | sed "s/\.git$//" | sed "s/:/\//" | sed "s/^git@/https:\/\//")/-/tree/$(git branch --show-current)?ref_type=heads"; echo "$(git config --get remote.origin.url | sed "s/\.git$//" | sed "s/:/\//" | sed "s/^git@/https:\/\//")/-/pipelines?ref=$(git branch --show-current | sed "s/\//%2F/g")"'

#=======================================
# Functions
#=======================================
ti() {
  if [[ $# -eq 0 ]]; then
    echo "Usage: ti <env_number>"
    echo "Example: ti 1"
    return 1
  fi

  local env_num="$1"

  if [[ -z "$CURR" ]]; then
    echo "Error: CURR environment variable not set"
    return 1
  fi

  cd "$CURR/terraform" || {
    echo "Error: Could not find terraform directory at $CURR/terraform"
    return 1
  }

  terraform init -backend-config="backend-dev${env_num}.hcl" -reconfigure
}

ci() {
  local target="${1:-.}"

  mkdir -p "$target/.claude/steps"
  touch "$target/.claude/CLAUDE.md" \
        "$target/.claude/README.md" \
        "$target/.claude/instructions.txt" \
        "$target/.claude/spec.md"
        

  echo "Initialized $target/.claude with:"
  echo "  - steps/"
  echo "  - CLAUDE.md"
  echo "  - README.md"
  echo "  - instructions.txt"
}

bootstrap() {
  "$DEV/.claude/config/bootstrap.sh"
}

repos() {
  local output=""
  for dir in "$DEV/Repos"/*/; do
    if [ -d "$dir/.git" ]; then
      local name=$(basename "$dir")
      local git_status=$(git -C "$dir" status -s)
      if [ -n "$git_status" ]; then
        local diff=$(git -C "$dir" diff --stat 2>/dev/null)
        output+="=== $name ===
$git_status
$diff

"
      fi
    fi
  done

  if [ -z "$output" ]; then
    echo "All repos clean - no uncommitted changes"
  else
    claude -p "Here are git changes across my repos:

$output

Summarize these changes. For each repo, explain what was modified in plain English and whether it looks like intentional work or drift. Be concise."
  fi
}